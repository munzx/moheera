"use strict";angular.module("cartModule",[]),angular.module("authModule",[]),angular.module("homeModule",[]);var moheera=angular.module("moheera",["ui.bootstrap","ui.router","ngResource","authModule","homeModule","userModule","productModule","orderModule","cartModule"]);moheera.config(["$urlRouterProvider","$stateProvider","$locationProvider",function(e,r,t){e.otherwise("notfound"),r.state("notfound",{url:"/notfound",templateUrl:"public/modules/config/view/notfound.config.view.html",controller:"errorConfigController",cache:!1}).state("droppedIn",{url:"",templateUrl:"public/modules/home/view/index.home.view.html",controller:"indexHomeController",cache:!1}).state("home",{url:"/",templateUrl:"public/modules/home/view/index.home.view.html",controller:"indexHomeController",cache:!1}).state("contact",{url:"/contact",templateUrl:"public/modules/home/view/contact.home.view.html",controller:"indexHomeController",cache:!1}).state("about",{url:"/about",templateUrl:"public/modules/home/view/about.home.view.html",controller:"indexHomeController",cache:!1}).state("signin",{url:"/signin",templateUrl:"public/modules/auth/view/signin.auth.view.html",controller:"signinAuthController",cache:!1}).state("signup",{url:"/signup",templateUrl:"public/modules/auth/view/signup.auth.view.html",controller:"signupAuthController",cache:!1}).state("signout",{url:"/signout",controller:"signoutAuthController",cache:!1}).state("profile",{url:"/profile",templateUrl:"public/modules/user/view/profile.user.view.html",controller:"profileUserControlller",cache:!1}).state("profile.category",{url:"/product/category/:category",templateUrl:"public/modules/user/view/category.user.view.html",controller:"categoryUserController"}).state("profile.remove",{url:"/remove",templateUrl:"public/modules/user/view/remove.account.user.view.html",controller:"removeAccountUserController",cache:!1}).state("profile.setting",{url:"/setting",templateUrl:"public/modules/user/view/setting.user.view.html",controller:"settingUserController",cache:!1}).state("profile.userPassword",{url:"/account/password",templateUrl:"public/modules/user/view/change.password.user.view.html",controller:"changePasswordUserController",cache:!1}).state("profile.orderDone",{url:"/order/done",templateUrl:"public/modules/order/view/done.order.view.html",controller:"allOrderController",cache:!1}).state("profile.orderCreate",{url:"/order/create",templateUrl:"public/modules/order/view/create.order.view.html",controller:"createOrderController",cache:!1}).state("profile.singleOrder",{url:"/product/:productId/order/:id/",templateUrl:"public/modules/order/view/single.order.view.html",controller:"singleOrderController",cache:!1}).state("profile.order",{url:"/order",templateUrl:"public/modules/order/view/all.order.view.html",controller:"allOrderController",cache:!1}).state("profile.addProduct",{url:"/product/add",templateUrl:"public/modules/product/view/add.product.view.html",controller:"addProductController",cache:!1}).state("profile.editProduct",{url:"/product/:name/edit",templateUrl:"public/modules/product/view/edit.product.view.html",controller:"editProductController",cache:!1}).state("profile.singleProduct",{url:"/product/:name",templateUrl:"public/modules/product/view/single.product.view.html",controller:"singleProductController",cache:!1}).state("profile.cart",{url:"/cart",templateUrl:"public/modules/cart/view/all.cart.view.html",controller:"allCartController",cache:!1}).state("user",{url:"/:userName",templateUrl:"public/modules/user/view/other.user.view.html",controller:"otherUserControlller",cache:!1}).state("user.singleProduct",{url:"/:productName",templateUrl:"public/modules/product/view/other.single.product.view.html",controller:"otherSingleProductControlller",cache:!1}).state("user.category",{url:"/product/category/:category",templateUrl:"public/modules/user/view/other.category.user.view.html",controller:"categoryUserController",cache:!1}),t.html5Mode(!0).hashPrefix("!")}]).run(["$rootScope",function(e){e.logged=!1,e.lastPage=""}]),angular.module("orderModule",[]),angular.module("productModule",[]),angular.module("userModule",[]),angular.module("cartModule").controller("allCartController",["$scope","$location","connectCartFactory","$state","registerUserConfigFactory",function(e,r,t,o,n){e.user=n.getUser(),t.query({action:"products"},function(r){e.cart=r}),e.onePlusQuantity=function(r){e.cart[r].quantity<20&&(e.cart[r].quantity++,t.update({product:e.cart[r]},function(){e.error=!1,e.user.cart=e.cart,n.setUser(e.user)},function(t){e.cart[r].quantity--,e.error=t.data.message}))},e.oneMinusQuantity=function(r){e.cart[r].quantity>=2&&(e.cart[r].quantity--,t.update({product:e.cart[r]},function(){e.error=!1,e.user.cart=e.cart,n.setUser(e.user)},function(t){e.cart[r].quantity++,e.error=t.data.message}))},e.removeCartProduct=function(r){t.remove({productId:e.cart[r].productId},function(){e.cart.splice(r,1),e.user.cart=e.cart})},e.goToOrder=function(){o.go("profile.orderCreate",{},{reload:!0})}}]),angular.module("cartModule").factory("connectCartFactory",["$resource",function(e){return e("/user/cart/:productId/:action",{productId:"@productId",action:"@action"},{update:{method:"PUT"}})}]),angular.module("authModule").controller("signinAuthController",["registerUserConfigFactory","$scope","$http","$location","$rootScope",function(e,r,t,o,n){r.signIn=function(){t.post("/login",r.credentials).success(function(r){e.setUser(r),o.path(n.lastPage?n.lastPage:"/profile")}).error(function(e){r.error=e})}}]),angular.module("authModule").controller("signoutAuthController",["registerUserConfigFactory","$http","$state",function(e,r,t){r.get("logout").success(function(){e.clearUserInfo(),t.go("home",{},{reload:!0})})}]),angular.module("authModule").controller("signupAuthController",["registerUserConfigFactory","$scope","$location","connectAuthFactory",function(e,r,t,o){e.getUser()&&t.path("/profile"),r.signUp=function(){o.save(r.credentials,function(){t.path("/signin")},function(e){r.error=e.data.message})}}]),angular.module("authModule").factory("connectAuthFactory",["$resource",function(e){return e("/user/:id")}]),angular.module("homeModule").controller("indexHomeController",["registerUserConfigFactory","$location","$scope",function(e,r,t){t.user=e.getUser(),t.user&&r.path("/profile")}]),angular.module("moheera").controller("ModalInstanceConfigController",["$scope","$rootScope","$modalInstance",function(e,r,t){e.cancel=function(){t.dismiss("cancel")}}]),angular.module("moheera").controller("errorConfigController",["$scope",function(){}]),angular.module("moheera").controller("navMenu",["$rootScope","$scope","registerUserConfigFactory",function(e,r,t){r.navbarCollapsed=!1,r.$on("$stateChangeSuccess",function(){r.navbarCollapsed=!1}),e.$watch("logged",function(){e.logged?(r.user=t.getUser(),r.loggedLink=!0,r.notLoggedLink=!1):(r.loggedLink=!1,r.notLoggedLink=!0)})}]),angular.module("moheera").directive("watchImageConfigDirective",["$modal","$rootScope",function(e,r){return{require:"?ngModel",restrict:"A",replace:!1,transclude:!1,scope:{id:"@id"},link:function(t,o,n,c){var a=document.getElementById(t.id+"Preview").getAttribute("src"),u="public/modules/home/img/loading.gif";document.getElementById(t.id+"Preview").onclick=function(){document.getElementById(t.id).click()},o.bind("change",function(){t.$apply(function(){c&&(c.$setViewValue(o.val()),c.$render())});var n=new FileReader;n.onloadstart=function(){document.getElementById(t.id+"Preview").setAttribute("src",u)},n.onabort=function(){document.getElementById(t.id+"Preview").setAttribute("src",path)},n.onload=function(o){if(o.loaded>1048576){c&&(c.$setValidity("file loaded",!1),c.$render()),document.getElementById(t.id+"Preview").setAttribute("src",a);var n=e.open({controller:function(){r.cancel=function(){n.dismiss("cancel")}},template:'<button ng-click="cancel()" type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="alert alert-danger text-center">Maximum image size is 1MB</h4>'})}else{t.$apply(function(){c&&(c.$setValidity("file loaded",!0),c.$render())});var u=o.target.result;document.getElementById(t.id+"Preview").setAttribute("src",u)}},n.readAsDataURL(o[0].files[0])})}}}]),angular.module("moheera").factory("registerUserConfigFactory",["$window","$rootScope","$q",function(e,r,t){var o={};return o.user=!1,o.readUserInfo=function(){return o.user=e.userInfo||!1},o.clearUserInfo=function(){r.logged=!1,r.lastPage="",o.user=e.userInfo=!1},o.setUser=function(t){o.user=e.userInfo=t||!1,o.user&&(r.logged=!0)},o.getUser=function(){var e=t.defer();return e.resolve(o.readUserInfo()),e.promise.then(function(e){e&&(o.user=e,r.logged=!0)}),o.user},o}]),angular.module("moheera").factory("requreLoginConfigFactory",["$modal","$rootScope","$location",function(e,r,t){return{open:function(o){r.lastPage=t.path(),o||(o=""),e.open({templateUrl:"public/modules/config/view/require.login.config.view.html",size:"md",controller:"ModalInstanceConfigController"})}}}]),angular.module("orderModule").controller("allOrderController",["$scope","$location","registerUserConfigFactory","connectOrderFactory","$state","statusOrderFactory",function(e,r,t,o,n,c){e.user=t.getUser(),e.statusOptions=c.status,e.showStatus=function(){var e={};return e.status="pending"},o.query(function(r){e.orderInfo=r},function(r){e.error=r.data.message}),e.orderDetails=function(e,r){n.go("profile.singleOrder",{productId:e,id:r},{reload:!0})}}]),angular.module("orderModule").controller("createOrderController",["$scope","$location","connectOrderFactory","registerUserConfigFactory",function(e,r,t,o){e.user=o.getUser(),e.cart=e.user.cart,e.cartInfo=function(){var r=e.user.cart,t=0,o=0;return r.forEach(function(e){o+=e.price*e.quantity,t+=e.quantity}),{totalQuantity:t,totalPrice:o}},e.confirmOrder=function(){var n={mobilePhone:e.newOrder.mobilePhone,address:e.newOrder.address,remarks:e.newOrder.remarks,status:"pending"};t.save({info:n},function(){r.path("profile/order/done"),e.user.cart=[],o.setUser(e.user)},function(r){e.error=r.data.message})}}]),angular.module("orderModule").controller("singleOrderController",["$scope","$location","connectOrderFactory","$stateParams","statusOrderFactory","registerUserConfigFactory",function(e,r,t,o,n,c){e.user=c.getUser(),e.statusOptions=n.status,t.get({productId:o.productId,id:o.id},function(r){e.orderInfo=r.order,e.productInfo=r.product,e.oldStatus=angular.copy(r.order.status)},function(r){e.error=r.data.message}),e.updateOrder=function(){var r={status:e.orderInfo.status,statusHistory:{oldStatus:e.oldStatus,updateRemarks:e.updateRemarks}};t.update({productId:o.productId,id:o.id},r,function(r){e.updateRemarks="",e.success=r,e.error=!1,e.orderInfo=r.order,e.oldStatus=angular.copy(r.order.status)},function(r){e.error=r.data.message,e.success=!1})}}]),angular.module("orderModule").factory("connectOrderFactory",["$resource",function(e){return e("/product/:productId/order/:id/:name",{productId:"@productId",id:"@id",name:"@name"},{update:{method:"PUT"}})}]),angular.module("orderModule").factory("statusOrderFactory",[function(){return{status:["delivered","pending","processing","canceled"]}}]),angular.module("orderModule").filter("statusOrderFilter",[function(){return function(e,r){var t=[];if(r)for(var o=0;o<e.length;o++){var n=e[o];n.status==r&&t.push(n)}else t=e;return t}}]),angular.module("productModule").controller("addProductController",["$scope","$location","connectProductFactory","categoryProductFactory","$state",function(e,r,t,o,n){e.categoryOptions=o,e.showImageUploadThumbnail=function(e){document.getElementById(e).click()},e.addProduct=function(){e.loading=!0;var r=new FormData;r.append("image1",document.getElementById("image1").files[0]),r.append("image2",document.getElementById("image2").files[0]),r.append("image3",document.getElementById("image3").files[0]),r.append("image4",document.getElementById("image4").files[0]),r.append("name",e.newProduct.name),r.append("price",e.newProduct.price),r.append("quantity",e.newProduct.quantity),r.append("category",e.newProduct.category),r.append("desc",e.newProduct.desc),t.save(r,function(){n.go("profile",{},{reload:!0}),e.loading=!1},function(r){e.loading=!1,console.log(r),e.error=r.data.message})},e.count=function(){for(var e=[],r=1;20>=r;r++)e.push(r);return e}}]),angular.module("productModule").controller("editProductController",["$scope","$stateParams","$location","connectProductFactory","categoryProductFactory",function(e,r,t,o,n){e.categoryOptions=n,o.get({getByName:r.name},function(r){e.productInfo=r},function(){t.path("/notfound")}),e.updateProductInfo=function(){var r=new FormData;r.append("image1",document.getElementById("image1").files[0]),r.append("image2",document.getElementById("image2").files[0]),r.append("image3",document.getElementById("image3").files[0]),r.append("image4",document.getElementById("image4").files[0]),r.append("name",e.productInfo.name),r.append("price",e.productInfo.price),r.append("quantity",e.productInfo.quantity),r.append("category",e.productInfo.category),r.append("desc",e.productInfo.desc),o.update({id:e.productInfo._id},r,function(){e.error=!1,e.success=!0},function(r){e.success=!1,e.error=r.data.message})}}]),angular.module("productModule").controller("otherSingleProductControlller",["$scope","$stateParams","connectProductFactory","$location","connectCommentProductFactory","registerUserConfigFactory","connectCartFactory","$state","requreLoginConfigFactory",function(e,r,t,o,n,c,a,u,l){e.user=c.getUser(),e.productName=r.name,t.get({getByName:r.productName},function(r){e.product=r},function(){}),e.showRemoveProductBox=function(){e.removeProductBox=!0},e.removeProduct=function(){t.remove({id:e.product._id},function(){u.go("profile",{},{reload:!0})},function(r){e.error=r.data.message})},e.cancelRemoveProduct=function(){e.removeProductBox=!1},e.addComment=function(){e.newComment&&n.save({id:e.product._id},{content:e.newComment},function(r){e.product.comment.push(r),e.newComment=""},function(r){403==r.status?l.open("comment"):e.error=r.data.message})},e.removeComment=function(r,t,o){n.remove({commentId:t,id:o},function(){e.product.comment.splice(r,1)},function(r){e.error=r.data.message})}}]),angular.module("productModule").controller("singleProductController",["$scope","$stateParams","connectProductFactory","$location","connectCommentProductFactory","registerUserConfigFactory","connectCartFactory","$state","requreLoginConfigFactory",function(e,r,t,o,n,c,a,u,l){e.user=c.getUser(),e.productName=r.name,t.get({getByName:e.productName},function(r){e.product=r},function(){o.path("/notfound")}),e.showRemoveProductBox=function(){e.removeProductBox=!0},e.removeProduct=function(){t.remove({id:e.product._id},function(){u.go("profile",{},{reload:!0})},function(r){e.error=r.data.message})},e.cancelRemoveProduct=function(){e.removeProductBox=!1},e.addComment=function(){e.newComment&&n.save({id:e.product._id},{content:e.newComment},function(r){e.product.comment.push(r),e.newComment=""},function(r){403==r.status?l.open("comment"):e.error=r.data.message})},e.removeComment=function(r,t,o){n.remove({commentId:t,id:o},function(){e.product.comment.splice(r,1)},function(r){e.error=r.data.message})}}]),angular.module("productModule").directive("cartIconProductDirective",["connectCartFactory","registerUserConfigFactory","requreLoginConfigFactory",function(e,r,t){return{restrict:"A",templateUrl:"public/modules/product/view/cart.icon.product.view.html",replace:!0,transclude:!0,scope:{product:"=cartIconProductDirective"},link:function(o){o.user=r.getUser(),o.$watch("product",function(e){var r=function(){if(e&&o.user){if(o.user.cart.length>0)for(var r=o.user.cart,t=0;t<=r.length;t++)if(r[t]&&r[t].productId==e._id)return!0;return!1}return!1};o.isChecked=r()}),o.addToCart=function(n){0==o.isChecked&&n.quantity>=1?e.save({productId:n._id,product:n},function(e){o.user.cart=e.cart,r.setUser(o.user),o.isChecked=!0},function(e){403==e.status&&t.open("cart")}):e.remove({productId:n._id},function(e){o.user.cart=e.cart,r.setUser(o.user),o.isChecked=!1})}}}}]),angular.module("productModule").directive("commentIconProductDirective",["registerUserConfigFactory",function(e){return{restrict:"A",templateUrl:"public/modules/product/view/comment.icon.product.view.html",replace:!0,transclude:!0,scope:{product:"=commentIconProductDirective"},link:function(r){var t=e.getUser();r.$watch("product",function(e){var o=function(){if(e){if(e.comment.length>0)for(var r=e.comment,o=0;o<r.length;o++)if(r[o].author[0]._id==t._id)return!0;return!1}return!1};r.isChecked=o()}),r.addComment=function(){$scope.newComment&&connectCommentProductFactory.save({id:$scope.product._id},{content:$scope.newComment},function(e){$scope.product.comment.push(e),$scope.newComment=""},function(e){$scope.error=e.data.message})},r.removeComment=function(e,r,t){connectCommentProductFactory.remove({commentId:r,id:t},function(){$scope.product.comment.splice(e,1)},function(e){$scope.error=e.data.message})}}}}]),angular.module("productModule").directive("heartIconProductDirective",["registerUserConfigFactory","connectHeartProductFactory","requreLoginConfigFactory",function(e,r,t){return{restrict:"A",templateUrl:"public/modules/product/view/heart.icon.product.view.html",replace:!0,transclude:!0,scope:{product:"=heartIconProductDirective"},link:function(o){var n=e.getUser();o.$watch("product",function(e){var r=function(){if(e){if(e.heart.length>0)for(var r=e.heart,t=0;t<=r.length;t++)if(r[t])for(var o=0;o<r[t].user.length;o++)if(r[t].user[o]._id===n._id)return!0;return!1}return!1};o.isChecked=r()}),o.heartProduct=function(e){0==o.isChecked?r.save({productId:e},function(e){o.product.heart=e.heart,o.isChecked=!0},function(e){403==e.status&&t.open("heart")}):r.remove({productId:e},function(e){o.product.heart=e.heart,o.isChecked=!1})}}}}]),angular.module("productModule").directive("productBoxProductDirective",["registerUserConfigFactory","$stateParams","$state",function(e){return{restrict:"A",templateUrl:"public/modules/product/view/product.box.product.view.html",replace:!0,transclude:!0,scope:{product:"=productBoxProductDirective"},link:function(r){var t=e.getUser();r.$watch("product",function(e){e&&(r.viewImageLink="public/uploads/"+e.image1,r.highlightImage=1,r.productLink=t._id==e.user?"/profile/product/"+e.name:"/"+e.userName+"/"+e.name,r.viewImage=function(t){switch(t){case"1":r.viewImageLink="public/uploads/"+e.image1,r.highlightImage=1;break;case"2":r.viewImageLink="public/uploads/"+e.image2,r.highlightImage=2;break;case"3":r.viewImageLink="public/uploads/"+e.image3,r.highlightImage=3;break;case"4":r.viewImageLink="public/uploads/"+e.image4,r.highlightImage=4;break;default:r.viewImageLink="public/uploads/"+e.image1,r.highlightImage=1}})})}}}]),angular.module("productModule").factory("categoryProductFactory",[function(){return["men","women","kid","gift","book"]}]),angular.module("userModule").factory("connectCommentProductFactory",["$resource",function(e){return e("product/:id/comment/:commentId",{id:"@id",commentId:"@commentId"})}]),angular.module("productModule").factory("connectHeartProductFactory",["$resource",function(e){return e("product/:productId/heart/:heartId",{productId:"@productId",heartId:"@heartId"})}]),angular.module("productModule").factory("connectProductFactory",["$resource",function(e){return e("/product/:userName/:action/:id/:getByName/:categoryName",{id:"@_id",action:"@action",categoryName:"@categoryName",getByName:"@getByName",userName:"@userName"},{update:{method:"PUT",withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity},save:{method:"POST",withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity}})}]),angular.module("userModule").controller("categoryUserController",["connectProductFactory","$stateParams","$scope","registerUserConfigFactory",function(e,r,t,o){var n=o.getUser();e.query({userName:r.userName||n.name,action:"category",categoryName:r.category},function(e){t.productByCategory=e})}]),angular.module("userModule").controller("changePasswordUserController",["$scope","$location","connectUserFactory",function(e,r,t){e.changeUserPassword=function(){e.success=!1,e.error=!1;var r=new FormData;r.append("newPassword",e.userInfo.newPassword),r.append("currentPassword",e.userInfo.currentPassword),t.update({action:"password"},r,function(){e.success=!0,e.userInfo.newPassword="",e.userInfo.currentPassword="",e.userInfo.verifyPassword=""},function(r){e.error=r.data.message})},e.noMatch=function(){return e.userInfo.newPassword==e.userInfo.verifyPassword?!1:!0}}]),angular.module("userModule").controller("otherUserControlller",["registerUserConfigFactory","connectProductFactory","$location","$scope","$stateParams",function(e,r,t,o,n){var c=e.getUser();r.get({action:"all",getByName:n.userName},function(e){o.userProducts=e.product,o.userInfo=e.user[0],o.userInfo._id===c._id&&t.path("/profile"),o.banner=function(){return o.userInfo?o.userInfo.banner?"public/uploads/"+o.userInfo.banner:"public/modules/config/img/banner.jpg":void 0}},function(){t.path("/notfound")})}]),angular.module("userModule").controller("profileUserControlller",["registerUserConfigFactory","connectProductFactory","$location","$scope",function(e,r,t,o){o.userInfo=e.getUser(),o.userInfo||t.path("/signin"),r.get({action:"all",getByName:o.userInfo.name},function(e){o.userProducts=e.product})}]),angular.module("userModule").controller("removeAccountUserController",["$scope","$location","connectUserFactory",function(e,r,t){e.cancelRemove=function(){r.path("/profile")},e.confirmRemove=function(){t.remove(function(){r.path("/")},function(r){e.error=r.data.message})}}]),angular.module("userModule").controller("settingUserController",["$scope","$location","connectUserFactory","registerUserConfigFactory","$state",function(e,r,t,o){e.userInfo=o.getUser(),e.removeAccount=function(){r.path("/profile/remove")},e.updateAccount=function(){var r=new FormData;r.append("logo",document.getElementById("logo").files[0]),r.append("banner",document.getElementById("banner").files[0]),r.append("firstName",e.userInfo.firstName),r.append("lastName",e.userInfo.lastName),r.append("email",e.userInfo.email),r.append("mobilePhone",e.userInfo.mobilePhone),r.append("pageDesc",e.userInfo.pageDesc),t.update(r,function(r){e.success=!0,e.userInfo.banner=r.banner,e.userInfo.logo=r.logo},function(r){e.error=r.data.message})}}]),angular.module("userModule").directive("sidebarUserDirective",["registerUserConfigFactory","$stateParams","connectProductFactory","$state",function(e,r,t){return{restrict:"A",templateUrl:"public/modules/user/view/sidebar.user.view.html",replace:!0,transclude:!0,scope:{product:"=sidebarUserDirective"},link:function(o){var n=[],c=e.getUser();o.profile=void 0==r.userName?"profile":r.userName,o.userName=void 0==r.userName?c.name:r.userName,o.$watch("product",function(e){e&&t.get({action:"category",userName:o.userName},function(e){o.user=e.user||c;var r=e.category;r&&(r.forEach(function(e){n.push({name:e,value:e,profile:o.profile})}),o.cats=n)})}),o.isActive=function(e){return e==r.category?!0:"all"!=e||r.category?void 0:!0}}}}]),angular.module("userModule").factory("connectUserFactory",["$resource",function(e){return e("/user/:action/:byUserName",{name:"@byUserName",action:"@action"},{update:{method:"PUT",withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity}})}]);